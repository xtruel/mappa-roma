<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Mappa Roma - 76 Best Places</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS tuo -->
  <link rel="stylesheet" href="style.css?v=2">

  <!-- CSS Mapbox -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
</head>
<body>
  <div id="sidebar">
    <div class="sidebar-header">
      <h1 id="site-title">Mappa Roma</h1>
      <p id="subtitle">Discover the Eternal City</p>
      <div class="language-switcher">
        <button id="lang-en" class="lang-btn active" data-lang="en">EN</button>
        <button id="lang-it" class="lang-btn" data-lang="it">IT</button>
      </div>
      
      <!-- Roma Matches Buttons -->
      <div class="roma-matches-section">

        <button id="roma-matches-btn" class="roma-btn">
          <span class="roma-icon">‚öΩ</span>
          <span class="roma-text">Partite Roma</span>
        </button>
      </div>
      
      <!-- Upcoming Matches Section -->
      <div class="upcoming-matches-section">
        <h3 id="upcoming-matches-title">Prossime Partite</h3>
        <div class="matches-tabs">
          <button id="men-matches-tab" class="match-tab active">Partite Maschili</button>
          <button id="women-matches-tab" class="match-tab">Partite Femminili</button>
        </div>
        <div id="upcoming-matches-content" class="matches-content">
          <!-- Matches will be loaded here -->
        </div>
      </div>
    </div>
    
    <!-- Map Provider Toggle -->
    <div class="map-toggle">
      <button id="mapbox-btn" class="toggle-btn active">Mapbox</button>
      <button id="google-btn" class="toggle-btn">Google Maps</button>
    </div>
    
    <!-- Category Filter -->
    <div class="category-filter">
      <h3>Categories</h3>
      <select id="category-select">
        <option value="all">All Places (76)</option>
        <option value="Ancient Sites">Ancient Sites</option>
        <option value="Vatican & Religious">Vatican & Religious</option>
        <option value="Fountains & Squares">Fountains & Squares</option>
        <option value="Museums & Galleries">Museums & Galleries</option>
        <option value="Parks & Gardens">Parks & Gardens</option>
        <option value="Neighborhoods">Neighborhoods</option>
        <option value="Hidden Gems">Hidden Gems</option>
        <option value="Football Venues">Football Venues</option>
      </select>
    </div>
    
    <!-- Places Counter -->
    <div class="places-counter">
      <span id="places-count">76 places shown</span>
    </div>
    
    <!-- Loading indicator moved to bottom of sidebar -->
    <div id="matches-loading" class="loading" style="display: none;">Caricamento partite...</div>
  </div>



  <!-- Roma Matches Modal -->
  <div id="roma-matches-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üë©‚Äç‚öΩ AS Roma Femminile - Prossime Partite</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <div id="matches-container" class="matches-list"></div>
        <div id="matches-error" class="error-message" style="display: none;">Errore nel caricamento delle partite. Riprova pi√π tardi.</div>
      </div>
    </div>
  </div>
  
  <div id="mapbox-container" class="map-container active">
    <div id="mapbox-map"></div>
  </div>
  
  <div id="google-container" class="map-container">
    <div id="google-map"></div>
  </div>

  <!-- JS Mapbox -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
  
  <!-- Google Maps API -->
  <!-- Google Maps API - Replace YOUR_GOOGLE_MAPS_API_KEY with your actual API key -->
  <!-- <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initGoogleMap"></script> -->

  <!-- Rome Places Data -->
  <script src="rome-places-data.js"></script>
  <script src="language-data.js"></script>
  
  <!-- File con i luoghi (legacy) -->
  <script src="luoghi.js"></script>

  <!-- Main Application Script -->
  <script>
    // Clear old cache on page load
    localStorage.removeItem('roma-women-matches-cache');
    localStorage.removeItem('roma-women-matches-cache-time');
    
    let currentLanguage = 'en';
    let mapboxMap, googleMap;
    let currentMapProvider = 'mapbox';
    let mapboxMarkers = [];
    let googleMarkers = [];
    let filteredPlaces = [];
    
    // Language switching functionality
    function switchLanguage(lang) {
      currentLanguage = lang;
      updateUILanguage();
      loadPlaces();
      
      // Update active language button
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(`lang-${lang}`).classList.add('active');
    }
    
    function updateUILanguage() {
      const texts = languageData[currentLanguage];
      
      // Update page title
      document.title = texts.pageTitle;
      
      // Update site title and subtitle
      document.getElementById('site-title').textContent = texts.siteTitle;
      document.getElementById('subtitle').textContent = texts.subtitle;
      
      // Update category filter
       const categorySelect = document.getElementById('category-select');
       categorySelect.innerHTML = `
         <option value="all">${texts.categories.all}</option>
         <option value="Ancient Sites">${texts.categories.ancientSites}</option>
         <option value="Vatican & Religious">${texts.categories.vaticanReligious}</option>
         <option value="Fountains & Squares">${texts.categories.fountainsSquares}</option>
         <option value="Museums & Galleries">${texts.categories.museumsGalleries}</option>
         <option value="Parks & Gardens">${texts.categories.parksGardens}</option>
         <option value="Neighborhoods">${texts.categories.neighborhoods}</option>
         <option value="Hidden Gems">${texts.categories.hiddenGems}</option>
         <option value="Football Venues">${texts.categories.footballVenues}</option>
       `;
      
      // Update upcoming matches section
      const upcomingMatchesTitle = document.getElementById('upcoming-matches-title');
      const menMatchesTab = document.getElementById('men-matches-tab');
      const womenMatchesTab = document.getElementById('women-matches-tab');
      
      if (upcomingMatchesTitle) upcomingMatchesTitle.textContent = texts.upcomingMatches;
      if (menMatchesTab) menMatchesTab.textContent = texts.menMatches;
      if (womenMatchesTab) womenMatchesTab.textContent = texts.womenMatches;
      
      // Update places counter
      updatePlacesCounter();
      
      // Reload upcoming matches to update translations
      if (typeof currentMatchType !== 'undefined') {
        loadUpcomingMatches(currentMatchType);
      }
    }
    
    function updatePlacesCounter() {
      const count = filteredPlaces.length;
      const texts = languageData[currentLanguage];
      document.getElementById('places-count').textContent = 
        `${count} ${count === 1 ? texts.placesCounter.singular : texts.placesCounter.plural}`;
    }
    
    function getLocalizedText(textObj) {
      return typeof textObj === 'object' ? textObj[currentLanguage] : textObj;
    }
    
    function getTranslation(key) {
      return languageData[currentLanguage][key] || key;
    }
    
    // Team logos mapping - Using CSS-based logos for better performance
    const teamLogos = {
      'AS Roma': { bg: '#FFCC00', color: '#8B0000', text: 'R' },
      'Roma': { bg: '#FFCC00', color: '#8B0000', text: 'R' },
      'SS Lazio': { bg: '#87CEEB', color: '#004688', text: 'L' },
      'Lazio': { bg: '#87CEEB', color: '#004688', text: 'L' },
      'S.S. Lazio': { bg: '#87CEEB', color: '#004688', text: 'L' },
      'Juventus FC': { bg: '#000000', color: '#ffffff', text: 'J' },
      'Juventus': { bg: '#000000', color: '#ffffff', text: 'J' },
      'Juventus Women': { bg: '#000000', color: '#ffffff', text: 'J' },
      'AC Milan': { bg: '#FF0000', color: '#ffffff', text: 'M' },
      'Milan': { bg: '#FF0000', color: '#ffffff', text: 'M' },
      'AC Milan Women': { bg: '#FF0000', color: '#ffffff', text: 'M' },
      'FC Internazionale Milano': { bg: '#004888', color: '#ffffff', text: 'I' },
      'Inter': { bg: '#004888', color: '#ffffff', text: 'I' },
      'Inter Women': { bg: '#004888', color: '#ffffff', text: 'I' },
      'Internazionale': { bg: '#004888', color: '#ffffff', text: 'I' },
      'SSC Napoli': { bg: '#007FFF', color: '#ffffff', text: 'N' },
      'AS Roma Femminile': { bg: '#FFCC00', color: '#8B0000', text: 'R' },
      'Genoa': { bg: '#FF0000', color: '#ffffff', text: 'G' },
      'Genoa CFC': { bg: '#FF0000', color: '#ffffff', text: 'G' },
      'Eintracht Frankfurt': { bg: '#000000', color: '#ffffff', text: 'E' },
      'Atalanta': { bg: '#1E90FF', color: '#000000', text: 'A' },
      'Atalanta BC': { bg: '#1E90FF', color: '#000000', text: 'A' },
      'Fiorentina': { bg: '#800080', color: '#ffffff', text: 'F' },
      'ACF Fiorentina': { bg: '#800080', color: '#ffffff', text: 'F' },
      'Torino': { bg: '#8B0000', color: '#ffffff', text: 'T' },
      'Torino FC': { bg: '#8B0000', color: '#ffffff', text: 'T' },
      'Bologna': { bg: '#FF0000', color: '#0000FF', text: 'B' },
      'Bologna FC': { bg: '#FF0000', color: '#0000FF', text: 'B' },
      'Udinese': { bg: '#000000', color: '#ffffff', text: 'U' },
      'Udinese Calcio': { bg: '#000000', color: '#ffffff', text: 'U' }
    };
    
    const defaultLogo = { bg: '#cccccc', color: '#666666', text: '‚öΩ' };
    
    function getTeamLogo(teamName) {
      return teamLogos[teamName] || defaultLogo;
    }
    
    function createTeamLogoElement(teamName, className = 'team-logo') {
      const logoData = getTeamLogo(teamName);
      return `<div class="${className}" style="background-color: ${logoData.bg}; color: ${logoData.color}; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; width: 32px; height: 16px; border-radius: 4px; margin-right: 8px;">${logoData.text}</div>`;
    }
    
    // Initialize application
    window.onload = function() {
      initMapbox();
      initUI();
      loadPlaces();
      updateUILanguage(); // Initialize UI with default language
      initUpcomingMatches(); // Initialize upcoming matches section
    };
    
    // Initialize Mapbox
    function initMapbox() {
      mapboxgl.accessToken = "pk.eyJ1IjoiZnVyaWVyb21hbmUiLCJhIjoiY21lZXBpZ2N5MGY2dzJtczlicTdieDZraiJ9.JVaKNpAZCi32InzFXzOSdw";
      
      mapboxMap = new mapboxgl.Map({
        container: "mapbox-map",
        style: "mapbox://styles/mapbox/streets-v11",
        center: [12.4964, 41.9028],
        zoom: 11
      });
      
      mapboxMap.addControl(new mapboxgl.NavigationControl());
    }
    
    // Initialize Google Maps (called by Google Maps API)
    window.initGoogleMap = function() {
      if (typeof google !== 'undefined' && google.maps) {
        googleMap = new google.maps.Map(document.getElementById('google-map'), {
          center: { lat: 41.9028, lng: 12.4964 },
          zoom: 11,
          mapTypeId: 'roadmap'
        });
        // Enable Google Maps button
        document.getElementById('google-btn').disabled = false;
        document.getElementById('google-btn').style.opacity = '1';
      }
    }
    
    // Initialize UI controls
    function initUI() {
      // Check if Google Maps is available
      if (typeof google === 'undefined' || !google.maps) {
        // Disable Google Maps button if API is not loaded
        const googleBtn = document.getElementById('google-btn');
        googleBtn.disabled = true;
        googleBtn.style.opacity = '0.5';
        googleBtn.title = 'Google Maps API key required';
      }
      
      // Map toggle buttons
      document.getElementById('mapbox-btn').addEventListener('click', () => switchMap('mapbox'));
      document.getElementById('google-btn').addEventListener('click', () => {
        if (typeof google !== 'undefined' && google.maps) {
          switchMap('google');
        } else {
          alert('Google Maps API key is required. Please add your API key to enable Google Maps.');
        }
      });
      
      // Category filter
      document.getElementById('category-select').addEventListener('change', filterPlaces);
      
      // Language switcher event listeners
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const lang = this.getAttribute('data-lang');
          switchLanguage(lang);
        });
      });
      
      // Roma matches button
      const romaMatchesBtn = document.getElementById('roma-matches-btn');
      if (romaMatchesBtn) {
        romaMatchesBtn.addEventListener('click', openRomaWomenMatchesModal);
      }
      
      // Modal close functionality
      const closeModalBtns = document.querySelectorAll('.close');
      closeModalBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
          const modal = e.target.closest('.modal');
          if (modal) {
            modal.style.display = 'none';
          }
        });
      });
      
      // Close modals when clicking outside of them
      window.addEventListener('click', (event) => {
        const romaModal = document.getElementById('roma-matches-modal');
        if (event.target === romaModal) {
          closeRomaWomenMatchesModal();
        }
      });
    }
    
    // Switch between map providers
    function switchMap(provider) {
      currentMapProvider = provider;
      
      // Update button states
      document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(provider + '-btn').classList.add('active');
      
      // Update map container visibility
      document.querySelectorAll('.map-container').forEach(container => container.classList.remove('active'));
      document.getElementById(provider + '-container').classList.add('active');
      
      // Reload markers for current provider
      loadPlaces();
    }
    
    // Load and display places
    function loadPlaces() {
      if (!window.romePlaces) return;
      
      // Clear existing markers
      clearMarkers();
      
      // Get filtered places
      const selectedCategory = document.getElementById('category-select').value;
      filteredPlaces = selectedCategory === 'all' 
        ? window.romePlaces 
        : window.romePlaces.filter(place => place.category === selectedCategory);
      
      // Update counter
      updatePlacesCounter();
      
      // Add markers based on current provider
      if (currentMapProvider === 'mapbox' && mapboxMap) {
        addMapboxMarkers();
      } else if (currentMapProvider === 'google' && googleMap) {
        addGoogleMarkers();
      }
    }
    
    // Add Mapbox markers
    function addMapboxMarkers() {
      filteredPlaces.forEach(place => {
        const name = getLocalizedText(place.name);
        const description = getLocalizedText(place.description);
        
        const marker = new mapboxgl.Marker({ color: getCategoryColor(place.category) })
          .setLngLat([place.lng, place.lat])
          .setPopup(new mapboxgl.Popup().setHTML(
            `<div class="popup-content">
              <h3>${name}</h3>
              <p><strong>Category:</strong> ${place.category}</p>
              <p>${description}</p>
            </div>`
          ))
          .addTo(mapboxMap);
        
        mapboxMarkers.push(marker);
      });
    }
    
    // Add Google Maps markers
    function addGoogleMarkers() {
      filteredPlaces.forEach(place => {
        const name = getLocalizedText(place.name);
        const description = getLocalizedText(place.description);
        
        const marker = new google.maps.Marker({
          position: { lat: place.lat, lng: place.lng },
          map: googleMap,
          title: name,
          icon: {
            url: `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(
              `<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <circle cx="10" cy="10" r="8" fill="${getCategoryColor(place.category)}" stroke="white" stroke-width="2"/>
              </svg>`
            )}`,
            scaledSize: new google.maps.Size(20, 20)
          }
        });
        
        const infoWindow = new google.maps.InfoWindow({
          content: `<div class="popup-content">
            <h3>${name}</h3>
            <p><strong>Category:</strong> ${place.category}</p>
            <p>${description}</p>
          </div>`
        });
        
        marker.addListener('click', () => {
          infoWindow.open(googleMap, marker);
        });
        
        googleMarkers.push(marker);
      });
    }
    
    // Clear all markers
    function clearMarkers() {
      mapboxMarkers.forEach(marker => marker.remove());
      mapboxMarkers = [];
      
      googleMarkers.forEach(marker => marker.setMap(null));
      googleMarkers = [];
    }
    
    // Filter places by category
    function filterPlaces() {
      loadPlaces();
    }
    
    // Get color for category
    function getCategoryColor(category) {
      const colors = {
        'Ancient Sites': '#8B4513',
        'Vatican & Religious': '#4169E1',
        'Museums & Galleries': '#9932CC',
        'Fountains & Squares': '#00CED1',
        'Parks & Gardens': '#32CD32',
        'Neighborhoods': '#FF8C00',
        'Hidden Gems': '#DC143C',
        'Football Venues': '#228B22'
      };
      return colors[category] || '#666666';
    }
    
    // Roma Matches Modal Functions
    // Roma Women Matches Modal Functions
    function openRomaWomenMatchesModal() {
      const modal = document.getElementById('roma-matches-modal');
      modal.style.display = 'block';
      loadRomaWomenMatches();
    }
    
    function closeRomaWomenMatchesModal() {
       const modal = document.getElementById('roma-matches-modal');
       modal.style.display = 'none';
     }
     
     async function loadRomaWomenMatches() {
       const loadingEl = document.getElementById('matches-loading');
       const containerEl = document.getElementById('matches-container');
       const errorEl = document.getElementById('matches-error');
       
       // Show loading, hide others
       loadingEl.style.display = 'block';
       containerEl.style.display = 'none';
       errorEl.style.display = 'none';
       
       // Check cache first
      const cacheKey = 'roma-women-matches-cache-v2';
      const cacheTimeKey = 'roma-women-matches-cache-time-v2';
       const cachedData = localStorage.getItem(cacheKey);
       const cacheTime = localStorage.getItem(cacheTimeKey);
       const now = new Date().getTime();
       const oneDay = 24 * 60 * 60 * 1000; // 24 ore in millisecondi
       
       // Se i dati sono in cache e non sono scaduti (meno di 24 ore), usali
       if (cachedData && cacheTime && (now - parseInt(cacheTime)) < oneDay) {
         try {
           const matches = JSON.parse(cachedData);
           displayWomenMatches(matches);
           return;
         } catch (e) {
           // Se c'√® un errore nel parsing, continua con i dati mock
         }
       }
       
       try {
         // Per ora usiamo dati mock per la Roma femminile
         // In futuro si potrebbe integrare con un'API specifica per il calcio femminile
         const mockWomenMatches = [
           {
             utcDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
             homeTeam: { name: 'AS Roma Femminile', crest: 'https://crests.football-data.org/100.png' },
             awayTeam: { name: 'Juventus Women', crest: 'https://crests.football-data.org/109.png' },
             competition: { name: 'Serie A Femminile' },
             venue: 'Stadio Tre Fontane'
           },
           {
             utcDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString(),
             homeTeam: { name: 'Inter Women', crest: 'https://crests.football-data.org/108.png' },
             awayTeam: { name: 'AS Roma Femminile', crest: 'https://crests.football-data.org/100.png' },
             competition: { name: 'Serie A Femminile' },
             venue: 'Stadio Breda'
           },
           {
             utcDate: new Date(Date.now() + 21 * 24 * 60 * 60 * 1000).toISOString(),
             homeTeam: { name: 'AS Roma Femminile', crest: 'https://crests.football-data.org/100.png' },
             awayTeam: { name: 'AC Milan Women', crest: 'https://crests.football-data.org/98.png' },
             competition: { name: 'Serie A Femminile' },
             venue: 'Stadio Tre Fontane'
           }
         ];
         
         // Salva i dati in cache con timestamp
         localStorage.setItem(cacheKey, JSON.stringify(mockWomenMatches));
         localStorage.setItem(cacheTimeKey, now.toString());
         
         displayWomenMatches(mockWomenMatches);
         
       } catch (error) {
         console.error('Error loading Roma women matches:', error);
         // Se c'√® un errore e abbiamo dati in cache (anche scaduti), usali
         if (cachedData) {
           try {
             const matches = JSON.parse(cachedData);
             displayWomenMatches(matches);
             return;
           } catch (e) {
             // Se anche il cache fallisce, mostra errore
           }
         }
         // Show error
         loadingEl.style.display = 'none';
         errorEl.style.display = 'block';
       }
     }


    
    function displayWomenMatches(matches) {
      const containerEl = document.getElementById('matches-container');
      const loadingEl = document.getElementById('matches-loading');
      
      loadingEl.style.display = 'none';
      containerEl.style.display = 'block';
      
      if (matches.length === 0) {
        containerEl.innerHTML = '<p class="no-matches">Nessuna partita programmata al momento.</p>';
        return;
      }
      
      let matchesHTML = '';
      
      for (let i = 0; i < matches.length; i++) {
        const match = matches[i];
        const date = new Date(match.utcDate);
        const formattedDate = date.toLocaleDateString('it-IT', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        const formattedTime = date.toLocaleTimeString('it-IT', {
          hour: '2-digit',
          minute: '2-digit'
        });
        
        const venue = match.venue || 'Stadio da definire';
        const competition = match.competition.name;
        
        matchesHTML += '<div class="match-item">';
        matchesHTML += '<div class="match-date">';
        matchesHTML += '<span class="date">' + formattedDate + '</span>';
        matchesHTML += '<span class="time">' + formattedTime + '</span>';
        matchesHTML += '</div>';
        matchesHTML += '<div class="match-teams">';
        matchesHTML += '<div class="team home">';
        matchesHTML += createTeamLogoElement(match.homeTeam.name);
        matchesHTML += '<span class="team-name">' + match.homeTeam.name + '</span>';
        matchesHTML += '</div>';
        matchesHTML += '<div class="vs">VS</div>';
        matchesHTML += '<div class="team away">';
        matchesHTML += createTeamLogoElement(match.awayTeam.name);
        matchesHTML += '<span class="team-name">' + match.awayTeam.name + '</span>';
        matchesHTML += '</div>';
        matchesHTML += '</div>';
        matchesHTML += '<div class="match-venue">';
        matchesHTML += '<span class="venue">üìç ' + venue + '</span>';
        matchesHTML += '<span class="competition">' + competition + '</span>';
        matchesHTML += '</div>';
        matchesHTML += '</div>';
      }
      
      containerEl.innerHTML = matchesHTML;
    }
    
    function displayMockMatches() {
      const containerEl = document.getElementById('matches-container');
      const loadingEl = document.getElementById('matches-loading');
      
      loadingEl.style.display = 'none';
      containerEl.style.display = 'block';
      
      // Mock data for demonstration
      const mockMatches = [
        {
          date: 'Domenica, 26 Gennaio 2025',
          time: '15:00',
          homeTeam: 'AS Roma',
          awayTeam: 'SSC Napoli',
          venue: 'Stadio Olimpico',
          competition: 'Serie A'
        },
        {
          date: 'Gioved√¨, 30 Gennaio 2025',
          time: '21:00',
          homeTeam: 'Eintracht Frankfurt',
          awayTeam: 'AS Roma',
          venue: 'Deutsche Bank Park',
          competition: 'Europa League'
        },
        {
          date: 'Domenica, 2 Febbraio 2025',
          time: '18:00',
          homeTeam: 'AS Roma',
          awayTeam: 'Genoa',
          venue: 'Stadio Olimpico',
          competition: 'Serie A'
        }
      ];
      
      let matchesHTML = '';
      
      for (let i = 0; i < mockMatches.length; i++) {
        const match = mockMatches[i];
        
        matchesHTML += '<div class="match-item">';
        matchesHTML += '<div class="match-date">';
        matchesHTML += '<span class="date">' + match.date + '</span>';
        matchesHTML += '<span class="time">' + match.time + '</span>';
        matchesHTML += '</div>';
        matchesHTML += '<div class="match-teams">';
        matchesHTML += '<div class="team home">';
        matchesHTML += createTeamLogoElement(match.homeTeam);
        matchesHTML += '<span class="team-name">' + match.homeTeam + '</span>';
        matchesHTML += '</div>';
        matchesHTML += '<div class="vs">VS</div>';
        matchesHTML += '<div class="team away">';
        matchesHTML += createTeamLogoElement(match.awayTeam);
        matchesHTML += '<span class="team-name">' + match.awayTeam + '</span>';
        matchesHTML += '</div>';
        matchesHTML += '</div>';
        matchesHTML += '<div class="match-venue">';
        matchesHTML += '<span class="venue">üìç ' + match.venue + '</span>';
        matchesHTML += '<span class="competition">' + match.competition + '</span>';
        matchesHTML += '</div>';
        matchesHTML += '</div>';
      }
      
      containerEl.innerHTML = matchesHTML;
    }
    
    // Upcoming Matches Functions
    let currentMatchType = 'men';
    
    function initUpcomingMatches() {
      const menTab = document.getElementById('men-matches-tab');
      const womenTab = document.getElementById('women-matches-tab');
      
      menTab.addEventListener('click', () => switchMatchTab('men'));
      womenTab.addEventListener('click', () => switchMatchTab('women'));
      
      loadUpcomingMatches('men');
    }
    
    function switchMatchTab(type) {
      currentMatchType = type;
      
      // Update tab appearance
      document.querySelectorAll('.match-tab').forEach(tab => tab.classList.remove('active'));
      document.getElementById(`${type}-matches-tab`).classList.add('active');
      
      // Load matches for selected type
      loadUpcomingMatches(type);
    }
    
    function loadUpcomingMatches(type) {
      const contentEl = document.getElementById('upcoming-matches-content');
      
      // Mock upcoming matches data with venue information
      const upcomingMatches = {
        men: [
          {
            date: '2024-01-20',
            time: '20:45',
            homeTeam: 'AS Roma',
            awayTeam: 'Juventus',
            competition: 'Serie A',
            venue: 'Stadio Olimpico',
            address: 'Viale dei Gladiatori 2, 00135 Roma',
            venueId: 71
          },
          {
            date: '2024-01-27',
            time: '18:00',
            homeTeam: 'SSC Napoli',
            awayTeam: 'AS Roma',
            competition: 'Serie A',
            venue: 'Stadio Diego Armando Maradona',
            address: 'Piazzale Vincenzo Tecchio, 80125 Napoli',
            venueId: null
          },
          {
            date: '2024-02-03',
            time: '15:00',
            homeTeam: 'AS Roma',
            awayTeam: 'Milan',
            competition: 'Serie A',
            venue: 'Stadio Olimpico',
            address: 'Viale dei Gladiatori 2, 00135 Roma',
            venueId: 71
          }
        ],
        women: [
          {
            date: '2024-01-21',
            time: '14:30',
            homeTeam: 'AS Roma Femminile',
            awayTeam: 'Juventus Women',
            competition: 'Serie A Femminile',
            venue: 'Stadio Tre Fontane',
            address: 'Via Acque Salvie 1, 00142 Roma',
            venueId: 73
          },
          {
            date: '2024-01-28',
            time: '12:30',
            homeTeam: 'Fiorentina Women',
            awayTeam: 'AS Roma Femminile',
            competition: 'Serie A Femminile',
            venue: 'Stadio Artemio Franchi',
            address: 'Viale Manfredo Fanti 4, 50137 Firenze',
            venueId: null
          }
        ]
      };
      
      displayUpcomingMatches(upcomingMatches[type], contentEl);
    }
    
    function displayUpcomingMatches(matches, containerEl) {
      if (!matches || matches.length === 0) {
        containerEl.innerHTML = `<div class="no-matches">${getTranslation('noUpcomingMatches')}</div>`;
        return;
      }
      
      const matchesHTML = matches.map(match => {
        const showMapButton = match.venueId ? 
          `<button class="show-on-map-btn" onclick="showVenueOnMap(${match.venueId})">${getTranslation('showOnMap')}</button>` : '';
        
        return `
          <div class="match-item">
            <div class="match-date">${formatMatchDate(match.date, match.time)}</div>
            <div class="match-teams">
              <div class="team home">
                ${createTeamLogoElement(match.homeTeam)}
                <span class="team-name">${match.homeTeam}</span>
              </div>
              <div class="vs">VS</div>
              <div class="team away">
                ${createTeamLogoElement(match.awayTeam)}
                <span class="team-name">${match.awayTeam}</span>
              </div>
            </div>
            <div class="match-venue">${getTranslation('venue')}: ${match.venue}</div>
            <div class="match-address">${getTranslation('address')}: ${match.address}</div>
            ${showMapButton}
          </div>
        `;
      }).join('');
      
      containerEl.innerHTML = matchesHTML;
    }
    
    function formatMatchDate(date, time) {
      const matchDate = new Date(date);
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      };
      return `${matchDate.toLocaleDateString(currentLanguage === 'it' ? 'it-IT' : 'en-US', options)} - ${time}`;
    }
    
    function showVenueOnMap(venueId) {
      const venue = romePlaces.find(place => place.id === venueId);
      if (venue && mapboxMap) {
        mapboxMap.flyTo({
          center: [venue.lng, venue.lat],
          zoom: 16,
          duration: 2000
        });
        
        // Create a temporary popup for the venue
        new mapboxgl.Popup()
          .setLngLat([venue.lng, venue.lat])
          .setHTML(`
            <div class="popup-content">
              <h3>${venue.name[currentLanguage]}</h3>
              <p>${venue.description[currentLanguage]}</p>
              ${venue.address ? `<p><strong>${getTranslation('address')}:</strong> ${venue.address}</p>` : ''}
            </div>
          `)
          .addTo(mapboxMap);
      }
    }
    
    // Legacy support for old luoghi.js
    if (window.PLACES) {
      window.PLACES.forEach(place => {
        if (mapboxMap) {
          new mapboxgl.Marker()
            .setLngLat(place.coords)
            .setPopup(new mapboxgl.Popup().setHTML(`<b>${place.name}</b><br>${place.desc}`))
            .addTo(mapboxMap);
        }
      });
    }
  </script>
</body>
</html>
